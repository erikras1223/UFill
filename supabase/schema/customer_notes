create table public.booking_equipment (
  id bigint generated always as identity not null,
  booking_id bigint not null,
  equipment_id bigint not null,
  quantity integer not null default 1,
  returned_at timestamp with time zone null,
  created_at timestamp with time zone not null default now(),
  constraint booking_equipment_pkey primary key (id),
  constraint booking_equipment_booking_id_fkey foreign KEY (booking_id) references bookings (id) on delete CASCADE,
  constraint booking_equipment_equipment_id_fkey foreign KEY (equipment_id) references equipment (id) on delete CASCADE
) TABLESPACE pg_default;

create trigger on_booking_equipment_change
after INSERT
or
update on booking_equipment for EACH row
execute FUNCTION update_equipment_quantities ();