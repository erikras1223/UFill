create table public.customer_notes (
  id bigint generated by default as identity not null,
  customer_id bigint not null,
  booking_id bigint null,
  source text not null,
  content text not null,
  is_read boolean not null default false,
  created_at timestamp with time zone not null default now(),
  constraint customer_notes_pkey primary key (id),
  constraint customer_notes_booking_id_fkey foreign KEY (booking_id) references bookings (id) on delete set null,
  constraint customer_notes_customer_id_fkey foreign KEY (customer_id) references customers (id) on delete CASCADE
) TABLESPACE pg_default;

create trigger on_new_note
after INSERT on customer_notes for EACH row
execute FUNCTION handle_new_note ();